import datetime
import yaml
import logging

logger = logging.getLogger(__name__)

with open('cfg.yml', 'r', encoding='utf-8') as f:
    cfg = yaml.load(f, Loader=yaml.FullLoader)
    logger.info('è®€å–cfg.ymlæˆåŠŸï¼')

class UpdateMsgGen():
    def __init__(
        self,
        intro: str = """
å¤ªæ£’äº†ï¼æˆ‘å€‘ä¼ºæœå™¨åˆæ›´æ–°äº†~~
å¿«ä¾†çœ‹çœ‹é€™æ¬¡æˆ‘å€‘åˆæ›´æ–°äº†äº›å•¥å§ï¼Œå¿«é»å–”ï¼
""",
        content: list = [
            "æ–°å¢äº†ä¸€å€‹æŒ‡ä»¤",
            "ä¿®å¾©äº†ä¸€äº›éŒ¯èª¤",
            "æ›´æ–°äº†ä¸€äº›å…§å®¹"
        ],
        starter: str = "959977374471028779"
    ):
        self.intro = intro
        # å°‡contentè½‰æ›æˆå­—ä¸²ï¼Œä¸¦åœ¨å­—ä¸²å‰æ–¹åŠ ä¸Šæ¸›è™Ÿèˆ‡ç©ºæ ¼ä½¿å…¶å¯ä»¥ç›´æ¥æ”¾å…¥markdownä¸­
        self.content = "\n".join([f"- {i}" for i in content])
        # åˆ©ç”¨datetimeå°‡ç•¶å‰æ™‚é–“è½‰æ›æˆUNIXæ™‚é–“æˆ³ï¼ˆå­—ä¸²ï¼‰
        self.timestamp = str(round(datetime.datetime.now().timestamp()))
        self.starter = starter
#         self.text = f"""
# ## é›²ç¾½æ›´æ–°

# {self.intro}

# ### æ›´æ–°å…§å®¹
# {self.content}


# æœ€å¾Œï¼Œç¥å„ä½ **<:gousthappy:1194802726442381312>åœ¨æœ¬æœä¸­éŠç©æ„‰å¿«ï¼**
# æœŸå¾…å„ä½çš„æ–°é€²åº¦ï¼Œæ°æ°ï¼

# ğŸ“¢ é›²ç¾½ç”Ÿå­˜æœ ç®¡ç†åœ˜éšŠ - <@{self.starter}> æ•¬ä¸Š
#    <t:{self.timestamp}:F>

# [ ||<@&1190290928112517212>||  |  ||<@&1190291336750960773>||  |  ||<@&1190298140692185128>||  |  ||<@&1186541054514704434>||]
# """
        try:
            self.text = cfg["update_format"].format(
                intro=self.intro,
                content=self.content,
                timestamp=self.timestamp,
                starter=self.starter
            )
        # åœ¨æ ¼å¼åŒ–ä¸­æ‰¾ä¸åˆ°ä½”ä½ç¬¦æ™‚æœƒå ±éŒ¯ï¼Œé€™æ™‚å°±å›å ±éŒ¯èª¤
        except KeyError:
            logger.warning("æ‰¾ä¸åˆ°ä½”ä½ç¬¦ï¼Œå°‡ä½¿ç”¨é è¨­è¨Šæ¯")
            self.text = f"""
## ä¼ºæœå™¨æ›´æ–°

{self.intro}

### æ›´æ–°å…§å®¹
{self.content}


æœ€å¾Œï¼Œç¥å„ä½ **<:gousthappy:1194802726442381312>åœ¨æœ¬æœä¸­éŠç©æ„‰å¿«ï¼**
æœŸå¾…å„ä½çš„æ–°é€²åº¦ï¼Œæ°æ°ï¼

ğŸ“¢ é›²ç¾½ç”Ÿå­˜æœ ç®¡ç†åœ˜éšŠ - <@{self.starter}> æ•¬ä¸Š
<t:{self.timestamp}:F>

[ ||<@&1190290928112517212>||  |  ||<@&1190291336750960773>||  |  ||<@&1190298140692185128>||  |  ||<@&1186541054514704434>||]
"""

class FixMsgGen():
    def __init__(
        self,
        intro: str = """
æŠ±æ­‰å„ä½ï¼Œæˆ‘å€‘ç™¼ç¾äº†ä¸€äº›å•é¡Œï¼Œå·²ç¶“æ’å®šå°‡è¦é–‹å§‹ä¿®å¾©...
æˆ‘å€‘å¾ˆå¿«å°±æœƒé–‹å§‹è™•ç†ï¼Œå¸Œæœ›å¤§å®¶çµ¦æˆ‘å€‘ä¸€äº›æ™‚é–“ >_<
ç‚ºäº†æä¾›æ›´æ£’çš„éŠæˆ²ç’°å¢ƒï¼Œå¸Œæœ›å¤§å®¶è¦‹è«’ï¼
""",
        content: list = [
            "ä¿®å¾©ä¸€äº›éŒ¯èª¤"
        ],
        reason: str = "æœªçŸ¥åŸå› ",
        time: dict = {
            "begin": "é‚„æœªæ’å®š",
            "end": "é‚„æœªæ’å®š"
        },
        starter: str = "959977374471028779"
    ):
        self.intro = intro
        # å°‡contentè½‰æ›æˆå­—ä¸²ï¼Œä¸¦åœ¨å­—ä¸²å‰æ–¹åŠ ä¸Šæ¸›è™Ÿèˆ‡ç©ºæ ¼ä½¿å…¶å¯ä»¥ç›´æ¥æ”¾å…¥markdownä¸­
        self.content = "\n".join([f"- {i}" for i in content])
        # åˆ©ç”¨datetimeå°‡ç•¶å‰æ™‚é–“è½‰æ›æˆUNIXæ™‚é–“æˆ³ï¼ˆå­—ä¸²ï¼‰
        self.timestamp = str(datetime.datetime.now().timestamp())
        self.reason = reason
        self.start = time["begin"]
        self.end = time["end"]
        self.starter = starter
#         self.text = f"""
# ## é›²ç¾½ç¶­ä¿®

# {self.intro}

# ### ç¶­ä¿®åŸå› 
# {self.reason}

# ### ç¶­ä¿®é è¨ˆæ™‚é–“
# - **<a:928961403749019649:1198243923915718706> é–‹å§‹**ï¼š{self.start}
# - **<a:928961427685904385:1198243930731458651> çµæŸ**ï¼š{self.end}

# ### ç¶­ä¿®é€ æˆå½±éŸ¿
# {self.content}

# ### ç¶­ä¿®ç‹€æ…‹
# <:dangerous:1254019093900558397> é‚„æœªé–‹å§‹


# å¾ˆæŠ±æ­‰æ‰“æ“¾å„ä½çš„ç”Ÿæ´»äº†ï¼Œå¸Œæœ›å„ä½è¦‹è«’
# ç‚ºäº†ç¶­æŒå®Œç¾çš„éŠæˆ²é«”é©—ï¼Œè®“æˆ‘å€‘ä¸€èµ·å…±å‰µæ›´ç¾å¥½çš„ä¼ºæœå™¨ï¼<a:yeees:1197923046149853195> 

# ğŸ“¢ é›²ç¾½ç”Ÿå­˜æœ ç®¡ç†åœ˜éšŠ - <@{self.starter}> æ•¬ä¸Š

# [ ||<@&1190290928112517212>||  |  ||<@&1190291336750960773>||  |  ||<@&1190298140692185128>||  |  ||<@&1186541054514704434>||]
# """
        try:
            self.text = cfg["fix_format"].format(
                intro=self.intro,
                reason=self.reason,
                start=self.start,
                end=self.end,
                content=self.content,
                starter=self.starter
            )
        # åœ¨æ ¼å¼åŒ–ä¸­æ‰¾ä¸åˆ°ä½”ä½ç¬¦æ™‚æœƒå ±éŒ¯ï¼Œé€™æ™‚å°±å›å ±éŒ¯èª¤
        except KeyError:
            logger.warning("æ‰¾ä¸åˆ°ä½”ä½ç¬¦ï¼Œå°‡ä½¿ç”¨é è¨­è¨Šæ¯")
            self.text = f"""
## ä¼ºæœå™¨ç¶­ä¿®

{self.intro}

### ç¶­ä¿®åŸå› 
{self.reason}

### ç¶­ä¿®é è¨ˆæ™‚é–“
- **<a:928961403749019649:1198243923915718706> é–‹å§‹**ï¼š{self.start}
- **<a:928961427685904385:1198243930731458651> çµæŸ**ï¼š{self.end}

### ç¶­ä¿®é€ æˆå½±éŸ¿
{self.content}

### ç¶­ä¿®ç‹€æ…‹
<:dangerous:1254019093900558397> é‚„æœªé–‹å§‹


å¾ˆæŠ±æ­‰æ‰“æ“¾å„ä½çš„ç”Ÿæ´»äº†ï¼Œå¸Œæœ›å„ä½è¦‹è«’
ç‚ºäº†ç¶­æŒå®Œç¾çš„éŠæˆ²é«”é©—ï¼Œè®“æˆ‘å€‘ä¸€èµ·å…±å‰µæ›´ç¾å¥½çš„ä¼ºæœå™¨ï¼<a:yeees:1197923046149853195> 

ğŸ“¢ é›²ç¾½ç”Ÿå­˜æœ ç®¡ç†åœ˜éšŠ - <@{self.starter}> æ•¬ä¸Š

[ ||<@&1190290928112517212>||  |  ||<@&1190291336750960773>||  |  ||<@&1190298140692185128>||  |  ||<@&1186541054514704434>||]
"""